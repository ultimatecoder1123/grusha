<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Pear Clicker: Evolution</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#83E8BA">
    <style>
        :root {
            --primary: #83E8BA;
            --secondary: #FFE27D;
            --accent: #FF6B6B;
            --dark: #2C3E50;
            --light: #FFFFFF;
            --shadow: rgba(0, 0, 0, 0.1);
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            -webkit-user-select: none;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: radial-gradient(circle at center, #fdfbf7 0%, #ebf5f0 100%);
            color: var(--dark);
            height: 100vh;
            overflow: hidden; /* Prevent scroll on mobile during frantic clicking */
            display: flex;
            flex-direction: column;
        }

        /* --- UI Layout --- */
        .header {
            padding: 15px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px var(--shadow);
            z-index: 10;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stats-container {
            display: flex;
            flex-direction: column;
        }

        .score-display {
            font-size: 1.8rem;
            font-weight: 800;
            color: #27ae60;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .per-sec {
            font-size: 0.9rem;
            color: #7f8c8d;
            font-weight: 600;
        }

        .game-area {
            flex: 1;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            touch-action: manipulation;
        }

        /* --- The Pear --- */
        .pear-container {
            position: relative;
            cursor: pointer;
            transition: transform 0.1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 5;
        }

        .pear-btn {
            font-size: clamp(120px, 25vw, 180px);
            filter: drop-shadow(0 10px 15px rgba(0,0,0,0.2));
            will-change: transform;
        }

        .pear-container:active {
            transform: scale(0.9);
        }

        /* --- Combo Meter --- */
        .combo-container {
            position: absolute;
            top: 20px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            text-align: center;
        }
        .combo-active { opacity: 1; }
        .combo-text { font-size: 1.5rem; font-weight: 900; color: var(--accent); transform: rotate(-5deg); }
        .combo-bar {
            width: 150px;
            height: 8px;
            background: #ddd;
            border-radius: 4px;
            margin-top: 5px;
            overflow: hidden;
        }
        .combo-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff9966, #ff5e62);
            width: 0%;
            transition: width 0.1s linear;
        }

        /* --- Shop & UI --- */
        .bottom-panel {
            height: 40vh;
            background: white;
            border-top-left-radius: 25px;
            border-top-right-radius: 25px;
            box-shadow: 0 -5px 30px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            z-index: 20;
            transition: transform 0.3s ease;
        }

        .tabs {
            display: flex;
            padding: 10px 20px;
            gap: 15px;
            border-bottom: 1px solid #eee;
        }

        .tab {
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            color: #95a5a6;
            cursor: pointer;
            transition: all 0.2s;
            background: #f8f9fa;
        }

        .tab.active {
            background: var(--primary);
            color: #1e5c36;
            transform: translateY(-2px);
        }

        .shop-content {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            scroll-behavior: smooth;
        }

        .shop-item {
            display: flex;
            align-items: center;
            background: #fff;
            border: 2px solid #f0f0f0;
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 10px;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }

        .shop-item.affordable {
            border-color: var(--primary);
            cursor: pointer;
            background: linear-gradient(to right, #ffffff, #f0fff4);
        }

        .shop-item.affordable:active {
            transform: scale(0.98);
        }

        .shop-item.locked {
            opacity: 0.6;
            filter: grayscale(1);
            pointer-events: none;
        }

        .item-icon { font-size: 2rem; margin-right: 15px; }
        .item-details { flex: 1; }
        .item-name { font-weight: 700; font-size: 1rem; }
        .item-cost { color: #e67e22; font-weight: 600; font-size: 0.9rem; }
        .item-bonus { color: #27ae60; font-size: 0.8rem; }
        .item-count {
            font-size: 1.2rem;
            font-weight: 800;
            color: #ecf0f1;
            background: #bdc3c7;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            margin-left: 10px;
        }
        .affordable .item-count { background: var(--primary); color: #0f3d22; }

        /* --- Particles & Effects --- */
        .click-particle {
            position: absolute;
            pointer-events: none;
            font-weight: bold;
            font-size: 1.5rem;
            color: #27ae60;
            animation: floatUp 0.8s ease-out forwards;
            z-index: 100;
            text-shadow: 1px 1px 0 #fff;
        }

        @keyframes floatUp {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-80px) scale(1.5); opacity: 0; }
        }

        /* --- Golden Pear --- */
        .golden-pear {
            position: fixed;
            font-size: 60px;
            z-index: 1000;
            cursor: pointer;
            animation: spin 1s infinite linear;
            filter: drop-shadow(0 0 10px gold);
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* --- Win Modal --- */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s;
        }
        .modal-overlay.visible { opacity: 1; pointer-events: auto; }
        .modal-card {
            background: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            max-width: 90%;
            width: 400px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            transform: translateY(20px);
            transition: transform 0.3s;
        }
        .modal-overlay.visible .modal-card { transform: translateY(0); }
        .win-btn {
            background: var(--primary);
            border: none;
            padding: 15px 30px;
            font-size: 1.2rem;
            font-weight: bold;
            border-radius: 30px;
            margin-top: 20px;
            cursor: pointer;
            width: 100%;
        }

        /* --- Achievements Popups --- */
        .achievements-container {
            position: fixed;
            top: 70px;
            right: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 100;
            pointer-events: none;
        }
        .achievement-toast {
            background: #333;
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideInRight 0.5s ease-out, fadeOut 0.5s ease-in 3.5s forwards;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .achievement-icon { font-size: 1.5rem; }
        @keyframes slideInRight { from { transform: translateX(100%); } to { transform: translateX(0); } }
        @keyframes fadeOut { to { opacity: 0; transform: translateY(-10px); } }

    </style>
</head>
<body>

    <div class="header">
        <div class="stats-container">
            <div class="score-display">üçê <span id="score">0</span></div>
            <div class="per-sec">‚ö° <span id="pps">0</span> / —Å–µ–∫</div>
        </div>
        <button id="menuBtn" style="background:none; border:none; font-size:1.5rem; cursor:pointer;">‚öôÔ∏è</button>
    </div>

    <div class="achievements-container" id="achievementsContainer"></div>

    <div class="game-area">
        <div class="combo-container" id="comboContainer">
            <div class="combo-text" id="comboText">x1.0 COMBO!</div>
            <div class="combo-bar"><div class="combo-fill" id="comboFill"></div></div>
        </div>

        <div class="pear-container" id="bigPear">
            <div class="pear-btn">üçê</div>
        </div>
    </div>

    <div class="bottom-panel">
        <div class="tabs">
            <div class="tab active" onclick="switchTab('upgrades')">–ú–∞–≥–∞–∑–∏–Ω</div>
            <div class="tab" onclick="switchTab('boosts')">–ë—É—Å—Ç—ã</div>
            <div class="tab" onclick="switchTab('stats')">–ò–Ω—Ñ–æ</div>
        </div>
        
        <div id="tab-upgrades" class="shop-content">
            <!-- Generated via JS -->
        </div>
        <div id="tab-boosts" class="shop-content" style="display:none;">
             <div class="shop-item affordable" onclick="Game.prestige()">
                <div class="item-icon">üëë</div>
                <div class="item-details">
                    <div class="item-name">–ó–∞–∫–æ–Ω—á–∏—Ç—å –ò–≥—Ä—É</div>
                    <div class="item-cost">–¶–µ–Ω–∞: 1,000,000,000 üçê</div>
                    <div class="item-bonus">–¢—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è –ø–æ–±–µ–¥—ã</div>
                </div>
            </div>
             <div style="text-align:center; padding:20px; color:#777;">
                 <p>–ö–ª–∏–∫–∞–π—Ç–µ –±—ã—Å—Ç—Ä–µ–µ, –ª–æ–≤–∏—Ç–µ –ó–æ–ª–æ—Ç—ã–µ –ì—Ä—É—à–∏!</p>
             </div>
        </div>
        <div id="tab-stats" class="shop-content" style="display:none;">
            <h3>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
            <p>–í—Å–µ–≥–æ –∫–ª–∏–∫–æ–≤: <span id="stat-clicks">0</span></p>
            <p>–ó–æ–ª–æ—Ç—ã—Ö –≥—Ä—É—à –ø–æ–π–º–∞–Ω–æ: <span id="stat-golden">0</span></p>
            <p>–í—Ä–µ–º—è –≤ –∏–≥—Ä–µ: <span id="stat-time">0</span> –º.</p>
            <button class="win-btn" style="background:#ff6b6b; margin-top:10px;" onclick="Game.resetSave()">–°–±—Ä–æ—Å –ø—Ä–æ–≥—Ä–µ—Å—Å–∞</button>
        </div>
    </div>

    <!-- Win Modal -->
    <div class="modal-overlay" id="winModal">
        <div class="modal-card">
            <h1 style="font-size:3rem; margin:0;">üçêüëë</h1>
            <h2>–í–´ - –ì–†–£–®–ï–í–´–ô –ú–ê–ì–ù–ê–¢!</h2>
            <p>–í—ã —Å–æ–±—Ä–∞–ª–∏ 1 –ú–∏–ª–ª–∏–∞—Ä–¥ –≥—Ä—É—à –∏ –¥–æ—Å—Ç–∏–≥–ª–∏ –ø—Ä–æ—Å–≤–µ—Ç–ª–µ–Ω–∏—è.</p>
            <p>–í—Ä–µ–º—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è: <span id="finalTime"></span> –º–∏–Ω.</p>
            <button class="win-btn" onclick="location.reload()">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
        </div>
    </div>

<script>
/**
 * PEAR CLICKER: EVOLUTION
 * Architecture:
 * 1. State Management (Data)
 * 2. Logic (Math, Ticks)
 * 3. UI (Rendering, Effects)
 */

// --- CONFIGURATION ---
const CONFIG = {
    FPS: 30,
    AUTOSAVE_INTERVAL: 10000, // 10 sec
    COMBO_DECAY: 0.5, // per tick
    COMBO_MAX: 4.0,
    GOLDEN_PEAR_CHANCE: 0.005, // Chance per tick (approx once per minute)
    WIN_CONDITION: 1000000000
};

// --- DATA DEFINITIONS ---
const BUILDINGS = [
    { id: 'cursor', name: '–ê–≤—Ç–æ-–ö—É—Ä—Å–æ—Ä', baseCost: 15, baseProd: 1, icon: 'üëÜ' },
    { id: 'grandma', name: '–ë–∞–±—É–ª—è', baseCost: 100, baseProd: 5, icon: 'üëµ' },
    { id: 'tree', name: '–ì—Ä—É—à–µ–≤–æ–µ –¥–µ—Ä–µ–≤–æ', baseCost: 1100, baseProd: 32, icon: 'üå≥' },
    { id: 'farm', name: '–§–µ—Ä–º–∞', baseCost: 12000, baseProd: 140, icon: 'üöú' },
    { id: 'factory', name: '–ó–∞–≤–æ–¥ —Å–æ–∫–∞', baseCost: 130000, baseProd: 800, icon: 'üè≠' },
    { id: 'bank', name: '–ì—Ä—É—à–µ–±–∞–Ω–∫', baseCost: 1400000, baseProd: 4500, icon: 'üè¶' },
    { id: 'temple', name: '–•—Ä–∞–º –ì—Ä—É—à–∏', baseCost: 20000000, baseProd: 18000, icon: '‚õ©Ô∏è' },
    { id: 'collider', name: '–ö–æ–ª–ª–∞–π–¥–µ—Ä', baseCost: 330000000, baseProd: 95000, icon: '‚öõÔ∏è' }
];

const ACHIEVEMENTS = [
    { id: 'first_100', name: '–ù–∞—á–∞–ª–æ –ø—É—Ç–∏', text: '–°–æ–±–µ—Ä–∏ 100 –≥—Ä—É—à', check: (s) => s.score >= 100 },
    { id: 'combo_king', name: '–ë—ã—Å—Ç—Ä—ã–µ –ø–∞–ª—å—Ü—ã', text: '–î–æ—Å—Ç–∏–≥–Ω–∏ –∫–æ–º–±–æ x4.0', check: (s) => s.combo >= 4.0 },
    { id: 'rich', name: '–ú–∏–ª–ª–∏–æ–Ω–µ—Ä', text: '–°–æ–±–µ—Ä–∏ 1,000,000 –≥—Ä—É—à', check: (s) => s.score >= 1000000 },
    { id: 'production', name: '–ò–Ω–¥—É—Å—Ç—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è', text: '1000 –≥—Ä—É—à –≤ —Å–µ–∫—É–Ω–¥—É', check: (s) => s.pps >= 1000 }
];

// --- GAME STATE ---
const State = {
    score: 0,
    clickCount: 0,
    goldenPearsCaught: 0,
    startTime: Date.now(),
    buildings: {}, // { id: count }
    achievements: [], // list of unlocked ids
    combo: 1.0,
    comboTimer: 0, // 0 to 100
    
    // Derived stats
    pps: 0, // Pears per second
    cpc: 1, // Clicks per click
};

// Initialize buildings map
BUILDINGS.forEach(b => State.buildings[b.id] = 0);

// --- LOGIC ENGINE ---
const Logic = {
    calculatePPS: () => {
        let pps = 0;
        BUILDINGS.forEach(b => {
            pps += (State.buildings[b.id] || 0) * b.baseProd;
        });
        State.pps = pps;
        return pps;
    },

    calculateClickPower: () => {
        // Base click is 1 + 5% of PPS
        return 1 + (State.pps * 0.05);
    },

    getCost: (buildingId) => {
        const b = BUILDINGS.find(x => x.id === buildingId);
        const count = State.buildings[buildingId];
        // Exponential cost curve: Base * 1.15^count
        return Math.floor(b.baseCost * Math.pow(1.15, count));
    },

    buy: (buildingId) => {
        const cost = Logic.getCost(buildingId);
        if (State.score >= cost) {
            State.score -= cost;
            State.buildings[buildingId]++;
            Logic.calculatePPS();
            UI.renderShop();
            UI.animatePurchase(buildingId);
        }
    },

    click: (x, y) => {
        State.clickCount++;
        
        // Combo logic
        State.comboTimer = 100;
        if (State.combo < CONFIG.COMBO_MAX) {
            State.combo += 0.1;
        } else {
            State.combo = CONFIG.COMBO_MAX;
        }

        const power = Logic.calculateClickPower() * Math.floor(State.combo);
        State.score += power;
        
        UI.createParticle(x, y, `+${Math.floor(power)}`);
        UI.punchPear();
        Logic.checkAchievements();
    },

    tick: () => {
        // Passive income
        if (State.pps > 0) {
            State.score += State.pps / CONFIG.FPS;
        }

        // Combo decay
        if (State.comboTimer > 0) {
            State.comboTimer -= 2; // Decay speed
        } else if (State.combo > 1.0) {
            State.combo -= 0.05;
            if (State.combo < 1.0) State.combo = 1.0;
        }

        // Golden Pear Spawn
        if (Math.random() < CONFIG.GOLDEN_PEAR_CHANCE) {
            UI.spawnGoldenPear();
        }

        Logic.checkAchievements();
    },

    checkAchievements: () => {
        ACHIEVEMENTS.forEach(ach => {
            if (!State.achievements.includes(ach.id) && ach.check(State)) {
                State.achievements.push(ach.id);
                UI.showToast(ach.icon || 'üèÜ', ach.name);
            }
        });
    }
};

// --- UI ENGINE ---
const UI = {
    els: {
        score: document.getElementById('score'),
        pps: document.getElementById('pps'),
        shop: document.getElementById('tab-upgrades'),
        pear: document.getElementById('bigPear'),
        combo: document.getElementById('comboContainer'),
        comboText: document.getElementById('comboText'),
        comboFill: document.getElementById('comboFill'),
        achievements: document.getElementById('achievementsContainer')
    },

    init: () => {
        UI.renderShop();
        
        // Bind Click
        UI.els.pear.addEventListener('pointerdown', (e) => {
            // Prevent default zoom functionality
            e.preventDefault(); 
            // Calculate center if touch event with no coords (sometimes happens on weak devices)
            const x = e.clientX || (window.innerWidth / 2);
            const y = e.clientY || (window.innerHeight / 3);
            Logic.click(x, y);
        });

        // Loop UI updates independent of Logic tick
        requestAnimationFrame(UI.loop);
    },

    loop: () => {
        // Format numbers nicely (e.g. 1.2M)
        UI.els.score.innerText = formatNumber(Math.floor(State.score));
        UI.els.pps.innerText = formatNumber(Math.floor(State.pps));
        
        // Update Combo UI
        if (State.combo > 1.1) {
            UI.els.combo.classList.add('combo-active');
            UI.els.comboText.innerText = `x${Math.floor(State.combo * 10) / 10} COMBO!`;
            UI.els.comboFill.style.width = `${State.comboTimer}%`;
        } else {
            UI.els.combo.classList.remove('combo-active');
        }

        // Update Shop Affordability
        const items = document.querySelectorAll('.shop-item');
        items.forEach(item => {
            const id = item.dataset.id;
            if(!id) return;
            const cost = Logic.getCost(id);
            if(State.score >= cost) {
                item.classList.add('affordable');
                item.classList.remove('locked');
            } else {
                item.classList.remove('affordable');
                // Optional: add locked class if way too expensive
                if (State.score < cost * 0.1 && Logic.getCost(id) > 1000) {
                     item.classList.add('locked');
                } else {
                     item.classList.remove('locked');
                }
            }
        });
        
        // Stats
        if(document.getElementById('tab-stats').style.display !== 'none') {
            document.getElementById('stat-clicks').innerText = State.clickCount;
            document.getElementById('stat-golden').innerText = State.goldenPearsCaught;
            const mins = Math.floor((Date.now() - State.startTime) / 60000);
            document.getElementById('stat-time').innerText = mins;
        }

        requestAnimationFrame(UI.loop);
    },

    renderShop: () => {
        UI.els.shop.innerHTML = '';
        BUILDINGS.forEach(b => {
            const currentCost = Logic.getCost(b.id);
            const currentCount = State.buildings[b.id];
            
            const div = document.createElement('div');
            div.className = 'shop-item';
            div.dataset.id = b.id;
            div.onclick = () => Logic.buy(b.id);
            
            div.innerHTML = `
                <div class="item-icon">${b.icon}</div>
                <div class="item-details">
                    <div class="item-name">${b.name}</div>
                    <div class="item-cost">–¶–µ–Ω–∞: ${formatNumber(currentCost)}</div>
                    <div class="item-bonus">+${formatNumber(b.baseProd)} / —Å–µ–∫</div>
                </div>
                <div class="item-count">${currentCount}</div>
            `;
            UI.els.shop.appendChild(div);
        });
    },

    punchPear: () => {
        const p = document.querySelector('.pear-btn');
        p.style.transform = 'scale(0.85)';
        setTimeout(() => p.style.transform = 'scale(1)', 50);
    },

    createParticle: (x, y, text) => {
        const p = document.createElement('div');
        p.className = 'click-particle';
        p.innerText = text;
        p.style.left = `${x}px`;
        p.style.top = `${y}px`;
        // Randomize direction slightly
        const rX = (Math.random() - 0.5) * 40;
        p.style.transform = `translateX(${rX}px)`;
        
        document.body.appendChild(p);
        setTimeout(() => p.remove(), 800);
    },

    showToast: (icon, title) => {
        const t = document.createElement('div');
        t.className = 'achievement-toast';
        t.innerHTML = `<span class="achievement-icon">${icon}</span> <span>${title}</span>`;
        UI.els.achievements.appendChild(t);
        setTimeout(() => t.remove(), 4000);
    },

    spawnGoldenPear: () => {
        const pear = document.createElement('div');
        pear.innerText = 'üçê';
        pear.className = 'golden-pear';
        // Random start vertical position
        const startY = Math.random() * (window.innerHeight - 100);
        pear.style.top = `${startY}px`;
        pear.style.left = '-60px';
        pear.style.transition = 'left 4s linear';
        
        pear.onpointerdown = (e) => {
            e.stopPropagation(); // Don't trigger main click
            
            // Bonus: 60 seconds of production OR 30% of current score, whichever is less (balance)
            const bonus = Math.max(State.pps * 60, State.score * 0.25) + 100;
            
            State.score += bonus;
            State.goldenPearsCaught++;
            UI.createParticle(e.clientX, e.clientY, `+${formatNumber(Math.floor(bonus))}!`);
            UI.showToast('üåü', '–ó–æ–ª–æ—Ç–∞—è –≥—Ä—É—à–∞ –ø–æ–π–º–∞–Ω–∞!');
            pear.remove();
        };

        document.body.appendChild(pear);
        
        // Trigger animation next frame
        requestAnimationFrame(() => {
            pear.style.left = '110vw';
        });

        // Cleanup
        setTimeout(() => { if(pear.parentNode) pear.remove(); }, 4100);
    },

    animatePurchase: (id) => {
        // Flash effects? Kept simple for now.
    }
};

// --- GAME CONTROLLER ---
const Game = {
    timer: null,
    
    start: () => {
        Game.load();
        Logic.calculatePPS();
        UI.init();
        
        // Logic loop (tick)
        Game.timer = setInterval(Logic.tick, 1000 / CONFIG.FPS);
        
        // Autosave
        setInterval(Game.save, CONFIG.AUTOSAVE_INTERVAL);
    },

    save: () => {
        const data = JSON.stringify(State);
        localStorage.setItem('pearEvolutionSave', data);
    },

    load: () => {
        const data = localStorage.getItem('pearEvolutionSave');
        if (data) {
            const loaded = JSON.parse(data);
            // Merge loaded data into State carefully
            Object.keys(loaded).forEach(k => {
                if(State.hasOwnProperty(k)) State[k] = loaded[k];
            });
            // Recalc
            Logic.calculatePPS();
        }
    },
    
    resetSave: () => {
        if(confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã? –í–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å—Å –±—É–¥–µ—Ç –ø–æ—Ç–µ—Ä—è–Ω.')) {
            localStorage.removeItem('pearEvolutionSave');
            location.reload();
        }
    },

    prestige: () => {
        if(State.score >= CONFIG.WIN_CONDITION) {
            Game.save();
            const mins = Math.floor((Date.now() - State.startTime) / 60000);
            document.getElementById('finalTime').innerText = mins;
            document.getElementById('winModal').classList.add('visible');
            
            // Celebration confetti (simple version)
            for(let i=0; i<50; i++) {
                setTimeout(() => {
                    UI.createParticle(
                        window.innerWidth/2 + (Math.random()-0.5)*300, 
                        window.innerHeight/2 + (Math.random()-0.5)*300, 
                        ['üçê','üëë','‚ú®'][Math.floor(Math.random()*3)]
                    );
                }, i*50);
            }

        } else {
            alert(`–í–∞–º –Ω—É–∂–Ω–æ ${formatNumber(CONFIG.WIN_CONDITION)} –≥—Ä—É—à –¥–ª—è –ø–æ–±–µ–¥—ã!`);
        }
    }
};

// --- UTILS ---
function formatNumber(num) {
    if (num >= 1000000000) return (num / 1000000000).toFixed(2) + 'B';
    if (num >= 1000000) return (num / 1000000).toFixed(2) + 'M';
    if (num >= 1000) return (num / 1000).toFixed(1) + 'k';
    return num.toLocaleString();
}

function switchTab(tabName) {
    // Hide all
    document.querySelectorAll('.shop-content').forEach(el => el.style.display = 'none');
    document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
    
    // Show one
    document.getElementById(`tab-${tabName}`).style.display = 'block';
    
    // Highlight tab
    // Finding the tab element is tricky without IDs, just using index matching or text
    const index = ['upgrades', 'boosts', 'stats'].indexOf(tabName);
    document.querySelectorAll('.tab')[index].classList.add('active');
}

// --- BOOTSTRAP ---
window.onload = Game.start;

</script>
</body>
</html>
